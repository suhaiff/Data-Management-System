{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
    <div class="nav-buttons mb-3">
        <button onclick="history.back()" class="btn btn-secondary me-2">
            <i class="fas fa-arrow-left me-1"></i> Previous
        </button>
        <a href="/" class="btn btn-primary me-2">
            <i class="fas fa-home me-1"></i> Home
        </a>
        <button onclick="history.forward()" class="btn btn-secondary">
            Next <i class="fas fa-arrow-right ms-1"></i>
        </button>
    </div>

    <h2 class="mb-3">Chart View</h2>

    <div id="loadingSpinner" class="text-center my-4">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading chart...</span>
        </div>
        <p class="mt-2">Loading your chart...</p>
    </div>

    <div class="chart-container mb-3" style="width: 100%; height: 100%; display: none;" id="chartWrapper">
        {# Embed the chart using an iframe for isolation and security #}
        {% if chart_file %}
            <iframe 
                src="{{ url_for('static', filename=chart_file) }}"
                style="width:100%; height:600px; border:none; border-radius:8px;"
                allowfullscreen
                loading="lazy"
                onload="document.getElementById('loadingSpinner').style.display='none'; this.style.display='block';">
            </iframe>
        {% else %}
            <p>No chart generated yet.</p>
        {% endif %}
    </div>

    <div class="actions">
        <a href="/data_model_2" class="btn btn-primary">Back to Chart Configuration</a>
    </div>
</div>

<style>
.chart-container {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    border-radius: 8px;
    overflow: hidden;
}
.actions {
    margin-top: 20px;
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    // Wait until all scripts (including Plotly) have loaded
    window.addEventListener('load', function() {
        const chartWrapper = document.getElementById("chartWrapper");
        const spinner = document.getElementById("loadingSpinner");

        // Hide spinner, show chart
        if (spinner) spinner.style.display = "none";
        if (chartWrapper) {
            chartWrapper.style.display = "block";
            chartWrapper.style.opacity = 0;

            // Smooth fade-in effect
            setTimeout(() => {
                chartWrapper.style.transition = "opacity 0.6s ease-in-out";
                chartWrapper.style.opacity = 1;
            }, 100);
        }
    });
});
</script>


{% endblock %}
